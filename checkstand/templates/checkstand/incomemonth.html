<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>收银台</title>
    {% load staticfiles %}
    <link href="{% static 'bootstrapt/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'bootstrapt/css/dashboard.css' %}" rel="stylesheet">
    <link href="{% static 'bootstrapt/css/buttons.css' %}" rel="stylesheet">
    <link href="{% static 'bootstrapt/css/bootstrap-datetimepicker.min.css' %}" rel="stylesheet" media="screen">
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">点餐后台管理</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Settings</a></li>
                <li><a href="#">tuichu</a></li>
                <li><a href="#">Help</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li><a href="{% url 'checkstand:home' %}">收银</a></li>
                <li><a href="{% url 'checkstand:page' 1 %}">历史订单</a></li>
            </ul>

            <ul class="nav nav-sidebar">
                <li><a href="{% url 'checkstand:deskmanage' %}">桌号管理</a></li>
                <li><a href="{% url 'checkstand:menukindmanage' %}">菜类管理</a></li>
                <li><a href="{% url 'checkstand:menumanage' %}">菜单管理</a></li>
            </ul>

            <ul class="nav nav-sidebar">
                <li><a href="{% url 'checkstand:incomeday' %}">日收入</a></li>
                <li class="active"><a href="{% url 'checkstand:incomemonth' %}">月收入</a></li>
                <li><a href="{% url 'checkstand:incomeyear' %}">年收入</a></li>
            </ul>

            <ul class="nav nav-sidebar">
                <li><a href="#">菜单分析</a></li>
                <li><a href="">订单分析</a></li>
            </ul>

        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div class="row">
                <form class="form-horizontal " role="form">
                    <legend>月收入分析</legend>
                    <div class="form-group">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-1">
                            <label for="dtp_input" class="control-label pull-right">日期选择：</label>
                        </div>
                        <div class="input-group date form_date col-md-3" data-date=""
                             data-date-format="yyyy-mm"
                             data-link-field="dtp_input" data-link-format="yyyy-mm">
                            <input class="form-control" type="text" id="dtp_input" value="" readonly>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                        </div>
                        <div class="col-md-1">
                            <input type="button" class="button button-primary button-small" onclick="querySubmit();"
                                   value="查询">
                        </div>
                        <div class="col-md-4">
                        </div>
                    </div>
                </form>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                月收入总览
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div id="main" style="width:auto;height:400px;"></div>
                        </div>
                    </div>
                </div>


            </div>
            <div class="row">
                <div class="col-md-5">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                日菜品销量详情
                            </h3>
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>菜名</th>
                                    <th>份数</th>
                                </tr>
                                </thead>
                                <tbody id="sales">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                日订单详情
                            </h3>
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>订单号</th>
                                    <th>桌号</th>
                                    <th>下单时间</th>
                                    <th>总价</th>
                                </tr>
                                </thead>
                                <tbody id="income">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'bootstrapt/js/jquery-1.12.0.min.js' %}"></script>
<script src="{% static 'bootstrapt/js/bootstrap.min.js' %}"></script>
<script src="{% static 'bootstrapt/js/echarts.min.js' %}"></script>
<script src="{% static 'bootstrapt/js/walden.js' %}"></script>
<script src="{% static 'bootstrapt/js/bootstrap-datetimepicker.js' %}"></script>
<script src="{% static 'bootstrapt/js/bootstrap-datetimepicker.zh-CN.js' %}"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.form_date').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 3,
            minView: 3,
            forceParse: 0
        });

    })


    function querySubmit() {
        var time = $("#dtp_input").val();
        if (time == "") {
            alert("输入为空")
        } else {
            ajaxPost(time)
        }

    }

    function ajaxPost(time) {

        $.ajax({
            headers: {"X-CSRFToken": '{{ csrf_token }}'},
            url: "{% url 'checkstand:monthincomajax' %}",
            type: 'POST',
            tradition: true,
            dataType: 'json',
            data: {time: time},
            success: function (data) {
                if (data.state == 'success') {
                    incomemonth = JSON.parse(data.incomemonth)
                    if (incomemonth != "") {
                        for (var key in incomemonth) {
                            console.log(incomemonth[key].fields.time)
                        }
                        {#income()#}

                    } else {
                        alert('没有' + time + '相关信息')
                    }
                }

            },

        })
    }

    function income() {
        var histogram = echarts.init(document.getElementById('main'), "walden");
        data = [["2000-06-05", 116], ["2000-06-06", 129], ["2000-06-07", 135], ["2000-06-08", 86], ["2000-06-09", 73], ["2000-06-10", 85], ["2000-06-11", 73], ["2000-06-12", 68], ["2000-06-13", 92], ["2000-06-14", 130], ["2000-06-15", 245], ["2000-06-16", 139], ["2000-06-17", 115], ["2000-06-18", 111], ["2000-06-19", 309], ["2000-06-20", 206], ["2000-06-21", 137], ["2000-06-22", 128], ["2000-06-23", 85], ["2000-06-24", 94], ["2000-06-25", 71], ["2000-06-26", 106], ["2000-06-27", 84], ["2000-06-28", 93], ["2000-06-29", 85], ["2000-06-30", 73], ["2000-07-01", 83], ["2000-07-02", 125], ["2000-07-03", 107], ["2000-07-04", 82], ["2000-07-05", 44], ["2000-07-06", 72], ["2000-07-07", 106], ["2000-07-08", 107], ["2000-07-09", 66], ["2000-07-10", 91], ["2000-07-11", 92], ["2000-07-12", 113], ["2000-07-13", 107], ["2000-07-14", 131], ["2000-07-15", 111], ["2000-07-16", 64], ["2000-07-17", 69], ["2000-07-18", 88], ["2000-07-19", 77], ["2000-07-20", 83], ["2000-07-21", 111], ["2000-07-22", 57], ["2000-07-23", 55], ["2000-07-24", 60]];

        var dateList = data.map(function (item) {
            return item[0];
        });
        var valueList = data.map(function (item) {
            return item[1];
        });

        option = {
            visualMap: [{
                show: false,
                type: 'continuous',
                seriesIndex: 0,
                min: 0,
                max: 400
            }],

            title: [{
                left: 'center',
                text: '月收入走势图'
            }],
            tooltip: {
                trigger: 'axis'
            },
            xAxis: [{
                data: dateList
            }],
            yAxis: [{
                splitLine: {show: false}
            }],

            series: [{
                type: 'line',
                showSymbol: false,
                data: valueList
            }]
        };
        histogram.setOption(option);
    }
</script>


</body>
</html>